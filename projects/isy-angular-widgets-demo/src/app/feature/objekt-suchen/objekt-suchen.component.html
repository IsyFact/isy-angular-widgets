<p-panel [header]="'isyAngularWidgetsDemo.menuItems.searchObject' | translate" [toggleable]="true" iconPos="start">
  <div class="grid mt-1 align-items-center">
    <div class="col-12 md:col-6 xl:col-4 py-0">
      <div class="grid p-1 align-items-center">
        <label for="id" class="col-12 sm:col-3 md:col-5 lg:col-4 sm:text-right text-left">ID</label>
        <div class="col-12 sm:col-9 md:col-7 lg:col-8">
          <input pInputText id="id" type="text" class="w-full ng-invalid ng-dirt" [(ngModel)]="person.id" />
        </div>
      </div>
    </div>
    <div class="col-12 md:col-6 xl:col-4 py-0">
      <div class="grid p-1 align-items-center">
        <label for="first-name" class="col-12 sm:col-3 md:col-5 lg:col-4 sm:text-right text-left">{{
          'isyAngularWidgetsDemo.labels.vorname' | translate
        }}</label>
        <div class="col-12 sm:col-9 md:col-7 lg:col-8">
          <!--  IsyInputChar can be configured with a Datentyp according to DIN 91379 -->
          <input id="first-name" type="text" pInputText isyInputChar [(ngModel)]="person.personalien.vorname" />
        </div>
      </div>
    </div>
    <div class="col-12 md:col-6 xl:col-4 py-0">
      <div class="grid p-1 align-items-center">
        <label for="last-name" class="col-12 sm:col-3 md:col-5 lg:col-4 sm:text-right text-left">{{
          'isyAngularWidgetsDemo.labels.nachname' | translate
        }}</label>
        <div class="col-12 sm:col-9 md:col-7 lg:col-8">
          <!--  IsyInputChar will add a special character picker to an input field -->
          <input id="last-name" type="text" pInputText isyInputChar [(ngModel)]="person.personalien.nachname" />
        </div>
      </div>
    </div>
    <div class="col-12 md:col-6 xl:col-4 py-0">
      <div class="grid p-1 align-items-center">
        <label for="birth-name" class="col-12 sm:col-3 md:col-5 lg:col-4 sm:text-right text-left">{{
          'isyAngularWidgetsDemo.labels.geburtsname' | translate
        }}</label>
        <div class="col-12 sm:col-9 md:col-7 lg:col-8">
          <input id="birth-name" class="w-full" type="text" pInputText [(ngModel)]="person.personalien.geburtsname" />
        </div>
      </div>
    </div>
    <div class="col-12 md:col-6 xl:col-4 py-0">
      <div class="grid p-1 align-items-center">
        <label for="birth-date" class="col-12 sm:col-3 md:col-5 lg:col-4 sm:text-right text-left">{{
          'isyAngularWidgetsDemo.labels.geburtsdatum' | translate
        }}</label>
        <div class="col-12 sm:col-9 md:col-7 lg:col-8">
          <p-calendar
            inputId="birth-date"
            dateFormat="dd.mm.yy"
            [(ngModel)]="person.personalien.geburtsdatum"
            [showIcon]="true"
            styleClass="w-full"
            appendTo="body"
          >
          </p-calendar>
        </div>
      </div>
    </div>
    <div class="col-12 md:col-6 xl:col-4 py-0">
      <div class="grid p-1 align-items-center">
        <label for="birth-place" class="col-12 sm:col-3 md:col-5 lg:col-4 sm:text-right text-left">{{
          'isyAngularWidgetsDemo.labels.geburtsort' | translate
        }}</label>
        <div class="col-12 sm:col-9 md:col-7 lg:col-8">
          <input id="birth-place" class="w-full" type="text" pInputText [(ngModel)]="person.personalien.geburtsort" />
        </div>
      </div>
    </div>
    <div class="col-12 md:col-6 xl:col-4 py-0">
      <div class="grid p-1 align-items-center">
        <label for="gender" class="col-12 sm:col-3 md:col-5 lg:col-4 sm:text-right text-left">{{
          'isyAngularWidgetsDemo.labels.geschlecht' | translate
        }}</label>
        <div class="col-12 sm:col-9 md:col-7 lg:col-8">
          <input id="gender" class="w-full" type="text" pInputText [(ngModel)]="person.personalien.geschlecht" />
        </div>
      </div>
    </div>
    <div class="col-12 md:col-6 xl:col-4 py-0">
      <div class="grid p-1 align-items-center">
        <label for="nationality" class="col-12 sm:col-3 md:col-5 lg:col-4 sm:text-right text-left">{{
          'isyAngularWidgetsDemo.labels.staatsangehoerigkeit' | translate
        }}</label>
        <div class="col-12 sm:col-9 md:col-7 lg:col-8">
          <p-dropdown
            id="nationality"
            [placeholder]="'isyAngularWidgetsDemo.labels.chooseCountry' | translate"
            [options]="laender"
            [(ngModel)]="person.personalien.staatsangehoerigkeit"
            [showClear]="true"
            styleClass="w-full"
            appendTo="body"
          >
            <ng-template pTemplate="selectedItem">
              <div class="country-item country-item-value" *ngIf="person.personalien.staatsangehoerigkeit">
                <span>{{ person.personalien.staatsangehoerigkeit }}</span>
              </div>
            </ng-template>
            <ng-template let-land pTemplate="item">
              <div class="country-item">
                <span>{{ land }}</span>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
      </div>
    </div>
  </div>

  <div class="flex justify-content-end p-2">
    <p-button
      id="search-button"
      class="mr-1"
      [label]="'isyAngularWidgetsDemo.actions.search' | translate"
      [iconPos]="'left'"
      [icon]="'pi pi-search'"
      (onClick)="findPerson()"
    >
    </p-button>
    <p-button
      [label]="'isyAngularWidgetsDemo.actions.clearSeebach' | translate"
      [iconPos]="'left'"
      [disabled]="!enableClearSearch()"
      (onClick)="clearSearch()"
    >
    </p-button>
  </div>
</p-panel>

<demo-result-list
  *ngIf="personen$ | async as personen"
  [personen]="personen"
  [selectedObject]="selectedPerson"
  (edit)="editSelectedPerson($event)"
  (create)="openAddNewObjectDialog()"
  [loading]="tbLoadingStatus"
>
</demo-result-list>

<p-dialog
  [header]="'isyAngularWidgetsDemo.editObjectDialog.header' | translate"
  [(visible)]="openEditForm"
  [modal]="modal"
  [style]="{
    width: width + 'vw'
  }"
>
  <div [formGroup]="editForm" *ngIf="selectedPerson && editForm">
    <div class="grid align-items-center">
      <div class="col-12 xl:col-6 py-0">
        <div class="grid p-1 align-items-center">
          <label for="edit-id" class="col-12 sm:col-4 md:col-3 xl:col-4 sm:text-right text-left">
            {{ 'isyAngularWidgetsDemo.labels.id' | translate }}
          </label>
          <div class="col-12 sm:col-8 md:col-9 xl:col-8">
            <input id="edit-id" class="w-full" type="text" pInputText [formControlName]="'editID'" />
          </div>
        </div>
      </div>
      <div class="col-12 xl:col-6 py-0">
        <div class="grid p-1 align-items-center">
          <label for="edit-vorname" class="col-12 sm:col-4 md:col-3 xl:col-4 sm:text-right text-left">
            {{ 'isyAngularWidgetsDemo.labels.vorname' | translate }}
          </label>
          <div class="col-12 sm:col-8 md:col-9 xl:col-8">
            <input id="edit-vorname" class="w-full" type="text" pInputText [formControlName]="'editVorname'" />
          </div>
        </div>
      </div>
      <div class="col-12 xl:col-6 py-0">
        <div class="grid p-1 align-items-center">
          <label for="edit-nachname" class="col-12 sm:col-4 md:col-3 xl:col-4 sm:text-right text-left">
            {{ 'isyAngularWidgetsDemo.labels.nachname' | translate }}
          </label>
          <div class="col-12 sm:col-8 md:col-9 xl:col-8">
            <input id="edit-nachname" class="w-full" type="text" pInputText [formControlName]="'editNachname'" />
          </div>
        </div>
      </div>
      <div class="col-12 xl:col-6 py-0">
        <div class="grid p-1 align-items-center">
          <label for="edit-geburtsname" class="col-12 sm:col-4 md:col-3 xl:col-4 sm:text-right text-left">
            {{ 'isyAngularWidgetsDemo.labels.geburtsname' | translate }}
          </label>
          <div class="col-12 sm:col-8 md:col-9 xl:col-8">
            <input id="edit-geburtsname" class="w-full" type="text" pInputText [formControlName]="'editGeburtsname'" />
          </div>
        </div>
      </div>
      <div class="col-12 xl:col-6 py-0">
        <div class="grid p-1 align-items-center">
          <label for="edit-geburtsdatum" class="col-12 sm:col-4 md:col-3 xl:col-4 sm:text-right text-left">
            {{ 'isyAngularWidgetsDemo.labels.geburtsdatum' | translate }}
          </label>
          <div class="col-12 sm:col-8 md:col-9 xl:col-8">
            <p-calendar
              id="edit-geburtsdatum"
              dateFormat="dd.mm.yy"
              [formControlName]="'editGeburtsdatum'"
              [showIcon]="true"
              styleClass="w-full"
              appendTo="body"
            >
            </p-calendar>
          </div>
        </div>
      </div>
      <div class="col-12 xl:col-6 py-0">
        <div class="grid p-1 align-items-center">
          <label for="edit-geburtsort" class="col-12 sm:col-4 md:col-3 xl:col-4 sm:text-right text-left">
            {{ 'isyAngularWidgetsDemo.labels.geburtsort' | translate }}
          </label>
          <div class="col-12 sm:col-8 md:col-9 xl:col-8">
            <input id="edit-geburtsort" class="w-full" type="text" pInputText [formControlName]="'editGeburtsort'" />
          </div>
        </div>
      </div>
      <div class="col-12 xl:col-6 py-0">
        <div class="grid p-1 align-items-center">
          <label for="edit-geschlecht" class="col-12 sm:col-4 md:col-3 xl:col-4 sm:text-right text-left">
            {{ 'isyAngularWidgetsDemo.labels.geschlecht' | translate }}
          </label>
          <div class="col-12 sm:col-8 md:col-9 xl:col-8">
            <input id="edit-geschlecht" class="w-full" type="text" pInputText [formControlName]="'editGeschlecht'" />
          </div>
        </div>
      </div>
      <div class="col-12 xl:col-6 py-0">
        <div class="grid p-1 align-items-center">
          <label for="edit-staatsangehörigkeit" class="col-12 sm:col-4 md:col-3 xl:col-4 sm:text-right text-left">
            {{ 'isyAngularWidgetsDemo.labels.staatsangehoerigkeit' | translate }}
          </label>
          <div class="col-12 sm:col-8 md:col-9 xl:col-8">
            <p-dropdown
              id="edit-staatsangehörigkeit"
              [placeholder]="'isyAngularWidgetsDemo.labels.chooseCountry' | translate"
              [options]="laender"
              [showClear]="true"
              [formControlName]="'editStaatsangehoerigkeit'"
              [editable]="true"
              styleClass="w-full"
              appendTo="body"
            >
              <ng-template pTemplate="selectedItem">
                <div class="country-item country-item-value" *ngIf="selectedPerson!.personalien.staatsangehoerigkeit">
                  <span>{{ selectedPerson!.personalien.staatsangehoerigkeit }}</span>
                </div>
              </ng-template>
              <ng-template let-land pTemplate="item">
                <div class="country-item">
                  <span>{{ land }}</span>
                </div>
              </ng-template>
            </p-dropdown>
          </div>
        </div>
      </div>
    </div>
    <div class="flex justify-content-end flex-wrap card-container pt-2">
      <p-button
        class="flex align-items-center justify-content-center mr-1"
        [label]="'isyAngularWidgetsDemo.actions.save' | translate"
        (onClick)="saveChanges()"
        [disabled]="!editForm.valid || !allowSave"
      >
      </p-button>
      <p-button
        class="flex align-items-center justify-content-center mr-1"
        [label]="'isyAngularWidgetsDemo.actions.close' | translate"
        (onClick)="displayEditDialog()"
      >
      </p-button>
    </div>
  </div>
</p-dialog>

<isy-wizard
  *ngIf="openWizard"
  [width]="50"
  [height]="30"
  [headerTitle]="'isyAngularWidgetsDemo.createObjectDialog.header' | translate"
  [allowNext]="isFormValid"
  [(isVisible)]="openWizard"
  (isVisibleChange)="onWizardClose($event)"
  (stepperIndexChange)="getWizardIndex($event)"
  (savingChange)="getSavedStatus($event)"
  [isSaved]="savedSuccessfully"
  [closable]="displayX"
>
  <!--  Every side of the wizard needs to have the *isyWizardDirective. -->

  <!-- Step 1: ID Entry -->
  <!--  Use with a simple form -->
  <div *isyWizardDirective="'isyAngularWidgetsDemo.createObjectDialog.stepIdEntry' | translate">
    <div [formGroup]="idForm">
      <div class="grid m-0">
        <div class="col-1 text-right align-self-center">
          <label id="id-label" for="person-id">ID</label><demo-required-label></demo-required-label>
        </div>
        <div class="col">
          <input
            id="person-id"
            type="text"
            class="w-full"
            pInputText
            [formControlName]="'id'"
            (focus)="onFormControlFocus(idForm.controls.id)"
          />
        </div>
      </div>
    </div>
  </div>

  <!-- Step 2: Personal information -->
  <!--  Use with a custom component -->
  <form *isyWizardDirective="'isyAngularWidgetsDemo.createObjectDialog.stepPersonalInfo' | translate">
    <demo-persoenliche-informationen [form]="persoenlicheInformationenForm"> </demo-persoenliche-informationen>
  </form>

  <!-- Step 3: Birth information -->
  <!--  Use with a complex form -->
  <div *isyWizardDirective="'isyAngularWidgetsDemo.createObjectDialog.stepBirthInfo' | translate">
    <div [formGroup]="geburtsInformationenForm">
      <div class="grid m-0">
        <div class="col-2 text-right align-self-center">
          <label id="geburtsname-label" class="align-content-end" for="geburtsname">
            {{ 'isyAngularWidgetsDemo.labels.geburtsname' | translate }} </label
          ><demo-required-label></demo-required-label>
        </div>
        <div class="col">
          <input
            id="geburtsname"
            class="w-full"
            type="text"
            pInputText
            [formControlName]="'geburtsname'"
            (focus)="onFormControlFocus(geburtsInformationenForm.controls.geburtsname)"
          />
        </div>
      </div>
      <div class="grid m-0">
        <div class="col-2 text-right align-self-center">
          <label id="geburtsort-label" class="align-content-end" for="geburtsort">
            {{ 'isyAngularWidgetsDemo.labels.geburtsort' | translate }} </label
          ><demo-required-label></demo-required-label>
        </div>
        <div class="col">
          <input
            id="geburtsort"
            class="w-full"
            type="text"
            pInputText
            [formControlName]="'geburtsort'"
            (focus)="onFormControlFocus(geburtsInformationenForm.controls.geburtsort)"
          />
        </div>
      </div>
      <div class="grid m-0">
        <div class="col-2 text-right align-self-center">
          <label id="geburtsdatum-label" class="align-content-end" for="geburtdatum">
            {{ 'isyAngularWidgetsDemo.labels.geburtsdatum' | translate }} </label
          ><demo-required-label></demo-required-label>
        </div>
        <div class="col-3">
          <p-calendar
            id="geburtdatum"
            dateFormat="dd.mm.yy"
            [formControlName]="'geburtsdatum'"
            [showIcon]="true"
            [appendTo]="'body'"
            (focusout)="onFormControlFocus(geburtsInformationenForm.controls.geburtsdatum)"
            appendTo="body"
          >
          </p-calendar>
        </div>
      </div>
      <div class="grid m-0">
        <div class="col-2 text-right align-self-center">
          <label id="staatsangehoerigkeit-label" class="align-content-end" for="staatangehoerigkeit">
            {{ 'isyAngularWidgetsDemo.labels.staatsangehoerigkeit' | translate }} </label
          ><demo-required-label></demo-required-label>
        </div>
        <div class="col-2">
          <p-dropdown
            id="staatangehoerigkeit"
            [placeholder]="'isyAngularWidgetsDemo.labels.chooseCountry' | translate"
            [showClear]="true"
            optionValue="name"
            optionLabel="name"
            [options]="countryMap"
            [formControlName]="'staatsangehoerigkeit'"
            [appendTo]="'body'"
            (focusout)="onFormControlFocus(geburtsInformationenForm.controls.staatsangehoerigkeit)"
            appendTo="body"
          >
            <ng-template let-land pTemplate="item">
              <div class="country-item">
                <span>{{ land.name }}</span>
              </div>
            </ng-template>
          </p-dropdown>
        </div>
      </div>
    </div>
  </div>
</isy-wizard>

<p-toast id="notification-toast" position="top-right"> </p-toast>
